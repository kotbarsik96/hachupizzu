let cart={},cartAmount={};function loadCartFromStorage(){null!=JSON.parse(localStorage.getItem("cart"))&&(cart=JSON.parse(localStorage.getItem("cart"))),null!=JSON.parse(localStorage.getItem("cartAmount"))&&(cartAmount=JSON.parse(localStorage.getItem("cartAmount")))}function loadCartToStorage(){null!=cart&&localStorage.setItem("cart",JSON.stringify(cart)),null!=cartAmount&&localStorage.setItem("cartAmount",JSON.stringify(cartAmount))}function renderCart(){for(let t in cart){if(0==cart[t].rendered&&"pizza"==cart[t].type){let e="";if(e+='<li class="menu_product_item" id="'+t+'" data-prod-type="'+cart[t].type+'"><div class="product_item_wrapper"><div class="menu_item_head"><div class="menu_item_head_wrapper">',e+='<h3 class="option_name">'+cart[t].name+"</h3>",e+='<div class="menu_item_price">'+cart[t].price+"</div>",e+='<div class="menu_item_image"><div class="item_image"><img src="'+cart[t].image+'"></div>',e+='<div class="item_cart"><div class="item_plus_image item_minus_image"><label for="'+t+'_remove" title="Нажмите, чтобы убрать из корзины"></label>',e+='<input id="'+t+'_remove" type="button" class="hidden_submit"></div>',e+='<div class="item_cart_image"></div></div></div></div></div>',e+='<div class="menu_item_body"><div class="item_body_description_wrapper"><div class="item_body_order_wrapper"><div class="item_body_order">',cart[t].options.ingreds.length>0){e+='<div class="product_ingreds_container product_option_container"><div class="option_header"><h3 class="option_name _grey_name">Ингридиенты</h3></div><div class="product_ingreds product_option"><ul class="selected_options_list">';for(let i of cart[t].options.ingreds)e+="<li>"+$('label[for="'+i+'"]').text()+"</li>";e+="</ul></div></div>"}e+='<div class="product_dough_container product_option_container"><div class="option_header"><h3 class="option_name _grey_name">Тесто</h3></div><div class="product_dough product_option"><ul class="selected_options_list">';for(let i of cart[t].options.dough)e+="<li>"+$('label[for="'+i+'"]').text()+"</li>";e+="</ul></div></div>",e+='<div class="product_size_and_slice">',e+='<div class="product_size_container product_option_container"><div class="option_header"><h3 class="option_name _grey_name">Размер</h3></div><div class="product_size product_option"><ul class="selected_options_list">';for(let i of cart[t].options.size)e+="<li>"+$('label[for="'+i+'"]').text()+"</li>";e+="</ul></div></div>",e+='<div class="product_slice_container product_option_container"><div class="option_header"><h3 class="option_name _grey_name">Нарезка</h3></div><div class="product_slice product_option"><ul class="selected_options_list">';for(let i of cart[t].options.slice)e+="<li>"+$('label[for="'+i+'"]').text()+"</li>";e+="</ul></div></div>",e+="</div></form></div></div></div></li>",$(".orders_list").append(e),cart[t].rendered=!0,$("#"+t+"_remove").on("click",(function(){removeFromCart(t)}))}if(0==cart[t].rendered&&"drink"==cart[t].type){let e="";if(e+='<li class="menu_product_item" id="'+t+'" data-prod-type="'+cart[t].type+'"><div class="product_item_wrapper"><div class="menu_item_head"><div class="menu_item_head_wrapper">',e+='<h3 class="menu_item_name">'+cart[t].name+"</h3>",e+='<div class="menu_item_price">'+cart[t].price+"</div>",e+='<div class="menu_item_image"><div class="item_image drink_image _no_hover"><img src="'+cart[t].image+'" alt="'+t+'"></div>',e+='<div class="item_cart"><div class="item_plus_image item_minus_image"><label for="'+t+'_remove" title="Нажмите, чтобы убрать из корзины"></label>',e+='<input type="button" id="'+t+'_remove"></div>',e+='<div class="item_cart_image"></div></div></div></div></div>',e+='<div class="menu_item_body" id="'+t+'_body_borders"><div class="item_body_wrapper">',null!=cart[t].options.size[0]){e+='<div class="item_body_size item_body_option _bottom_border"><div class="drink_option_header"><h3 class="option_name _grey_name">Размер</h3></div>',e+='<div class="drink_option_size drink_option"><ul>';for(let i of cart[t].options.size)e+="<li>"+$('label[for="'+i+'"]').text()+"</li>";e+="</ul></div></div>"}if(null!=cart[t].options.taste[0]){e+='<div class="item_body_taste item_body_option _bottom_border"><div class="drink_option_header"><h3 class="option_name _grey_name">Вкус</h3></div>',e+='<div class="drink_option_taste drink_option"><ul>';for(let i of cart[t].options.taste)e+="<li>"+$('label[for="'+i+'"]').text()+"</li>";e+="</ul></div></div>"}if(null!=cart[t].options.additional[0]){e+='<div class="item_body_additional item_body_option"><div class="drink_option_header"><h3 class="option_name _grey_name">Дополнительно</h3></div>',e+='<div class="drink_option_additional drink_option"><ul>';for(let i of cart[t].options.additional)e+="<li>"+$('label[for="'+i+'"]').text()+"</li>";e+="</ul></div></div>"}e+="</div></div></div></li>",$(".orders_list").append(e);let i=$("#"+t+"_body_borders").children().children();2==i.length&&i[1].classList.remove("_bottom_border"),cart[t].rendered=!0,$("#"+t+"_remove").on("click",(function(){removeFromCart(t)}))}}countProducts()}function addToCart(t){let e=$("#"+t+"_form");null==cartAmount[t]?cartAmount[t]=1:cartAmount[t]++;let i=t+cartAmount[t];for(let e in cart)if(e==i)do{i=t+cartAmount[t],cartAmount[t]++}while(e==i);if(cart[i]={},cart[i].name=$("#"+t+"_name").text(),cart[i].price=$("#"+t+"_price").text(),cart[i].image=$("#"+t+"_image").children("img").attr("src"),cart[i].rendered=!1,cart[i].number=i.slice(i.length-1),cart[i].type=e.attr("data-product-type"),console.log(e),"pizza"==cart[i].type){cart[i].options={ingreds:[],dough:[],size:[],slice:[]};for(let t of e.children(".ingreds_checkbox").children("input:checked"))cart[i].options.ingreds.push(t.getAttribute("id"));for(let t of e.children(".dough_checkbox").children("input:checked"))cart[i].options.dough.push(t.getAttribute("id"));for(let t of e.children(".size_checkbox").children("input:checked"))cart[i].options.size.push(t.getAttribute("id"));for(let t of e.children(".slice_checkbox").children("input:checked"))cart[i].options.slice.push(t.getAttribute("id"))}if("drink"==cart[i].type){cart[i].options={size:[],taste:[],additional:[]};for(let t of e.children(".size_checkbox").children("input:checked"))cart[i].options.size.push(t.getAttribute("id"));for(let t of e.children(".taste_checkbox").children("input:checked"))cart[i].options.taste.push(t.getAttribute("id"));for(let t of e.children(".additional_checkbox").children("input:checked"))cart[i].options.additional.push(t.getAttribute("id"))}renderCart()}function removeFromCart(t){delete cart[t],cartAmount[t.substring(0,t.length-1)]=1,$("#"+t).addClass("_removed"),setTimeout(()=>{$("#"+t).remove(),renderCart()},1200)}function filterCart(){let t=$("#filter_button"),e=t.val(),i=t.children(),o=$(".menu_product_item"),r=$(".filter_button_image");if("all"!=t.val()){r.addClass("_active");for(let t of i)if(t.value==e)for(let e of o){let i=e.getAttribute("data-prod-type");null!=i&&i==t.value&&e.classList.remove("_hidden")}else if("all"!=t.value)for(let e of o){let i=e.getAttribute("data-prod-type");null!=i&&i==t.value&&e.classList.add("_hidden")}}if("all"==t.val()){for(let t of o){null!=t.getAttribute("data-prod-type")&&t.classList.remove("_hidden")}r.removeClass("_active")}countProducts()}function countProducts(){let t=$(".orders_list").children("li:not(._hidden)"),e=t.length;e>0?$("#nothing_here").addClass("_hidden"):$("#nothing_here").removeClass("_hidden");let i=0;for(let e of t){let t=cart[e.id].price;i+=parseInt(t.replace(" рублей",""))}1==e?$("#orders_count").text(e+" товар"):e<5&&0!=e?$("#orders_count").text(e+" товара"):$("#orders_count").text(e+" товаров"),$("#orders_totalprice").text(i+" рублей")}$(document).ready((function(){loadCartFromStorage(),setTimeout(()=>{for(let t in cart)cart[t].rendered=!1;renderCart()},500),filterCart(),$("#filter_button").on("change",(function(){filterCart()}))}));let prods=$(".menu_product_item");for(let t of prods)$("#"+t.getAttribute("id")+"_order").on("click",(function(){addToCart(t.getAttribute("id"))}));
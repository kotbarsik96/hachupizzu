$(document).ready((function(){$("#start_warship_button").on("click",(function(){c.startGame(),r.createShips(),console.log(r.ships)}));class t{constructor(t){this.statContainerName=t}calcHeight(){let t,s=document.querySelectorAll("#"+this.statContainerName+"_header");for(let e of s)t=e.offsetHeight;return t-3}showStats(){document.querySelectorAll("#"+this.statContainerName)[0].style.maxHeight="20em"}hideStats(){document.querySelectorAll("#"+this.statContainerName)[0].style.maxHeight=this.calcHeight()+"px"}checkClasses(){$("#"+this.statContainerName).attr("class").includes("_hidden_stats")&&$("#"+this.statContainerName+"_header").attr("class").includes("_hidden_stats")?this.hideStats():this.showStats()}}let s=$(".stats_container");if(s.length>0)for(statContainer of s){let s=statContainer.getAttribute("id"),e=new t(s);e.checkClasses(),$("#"+s+"_header").on("click",(function(){$("#"+s).toggleClass("_hidden_stats"),$(this).toggleClass("_hidden_stats"),e.checkClasses()}))}let e=function(t){$("#"+t).addClass("hit")},i=function(t){$("#"+t).addClass("miss")},n=function(t){t.attr("placeholder","Неверная координата!")},o=function(t){t.attr("placeholder","Введите координату")},h={shotsMade:function(){$("#shots_stats").text(r.shoots)},misses:function(){$("#misses_stats").text(r.misses)},hittedShips:function(){$("#hitted_stats").text(r.hitted)},sunkenShips:function(){$("#sunken_stats").text(r.shipsSunken)},score:function(){$("#score_stats").text(r.currentScore)}},a={totalGames:function(){$("#games_total").text(r.totalGames)},score:function(){$("#score").text(r.score)}},r={shipLength:4,shipsAmount:5,shipsTotal:5,shoots:0,misses:0,hits:0,hitted:0,shipsSunken:0,currentScore:0,totalGames:0,wins:0,score:0,letters:["A","B","C","D","E","F","G","H","I","J"],numbers:["1","2","3","4","5","6","7","8","9","10"],locationsBlank:[],ships:[ship1={locations:[],hits:[],sunken:!1,hitted:!1},ship2={locations:[],hits:[],sunken:!1,hitted:!1},ship3={locations:[],hits:[],sunken:!1,hitted:!1},ship4={locations:[],hits:[],sunken:!1,hitted:!1},ship5={locations:[],hits:[],sunken:!1,hitted:!1}],createShips:function(){for(let t of this.ships){this.locationsBlank=this.generateShip();do{this.locationsBlank=this.generateShip()}while(this.checkCollision(this.locationsBlank));t.locations=this.locationsBlank}},generateShip:function(){let t=Math.floor(2*Math.random()),s=Math.floor(6*Math.random()),e=Math.floor(10*Math.random()),i=[];if(0==t){let t=this.letters[e],n=this.numbers[s],o=t+n;i[0]=o;for(let e=1;e<this.shipLength;e++)n=this.numbers[s+e],o=t+n,i[e]=o}else if(0!==t){let t=this.letters[s],n=this.numbers[e],o=t+n;i[0]=o;for(let e=1;e<this.shipLength;e++)t=this.letters[s+e],o=t+n,i[e]=o}return i},checkCollision:function(t){for(let s of t)for(let t of this.ships)if(t.locations.indexOf(s)>=0)return!0;return!1},makeShot:function(t){for(let s=0;s<5;s++){let e=this.ships[s];for(let s=0;s<this.shipLength;s++)if(e.locations[s]==t){let s=$("#"+t);if("hit"!==s.attr("class"))return e.hits.push("hit"),r.currentScore+=5,!0;if("hit"==s.attr("class"))return!0}}return!1},checkSunk:function(){for(let t of this.ships)if(!0!==t.sunken&&t.hits.length==this.shipLength)return t.sunken=!0,!0;return!1},checkEnter:function(t){let s=t.charAt(0);if(null==t||t.length<2||t.length>3||r.letters.indexOf(s)<0)return console.log("Координата не прошла проверку по букве"),!1;let e=t.charAt(1);if(2==t.length){if(r.numbers.indexOf(e)<0)return console.log("Координата из двух символов не прошла проверку"),!1}else if(3==t.length){let s=t.charAt(2);if("1"!==e||"0"!==s)return console.log("Координата из трёх символов не прошла проверку"),!1}return!0}},c={startGame:function(){$("#start_warship_button").toggleClass("_hidden"),$("#stats_local").toggleClass("_hidden"),$("#warship_console").toggleClass("_hidden")},endGame:function(){this.startGame();let t=$("td");for(let s of t)"miss"!=s.getAttribute("class")&&"hit"!=s.getAttribute("class")||s.removeAttribute("class");for(let t of r.ships)t.hits=[],t.sunken=!1;r.shoots=0,r.misses=0,r.hits=0,r.hitted=0,r.shipsSunken=0,r.score+=r.currentScore,r.currentScore=0,r.totalGames+=1,r.wins+=1,h.shotsMade(),h.misses(),h.hittedShips(),h.sunkenShips(),h.score(),a.totalGames(),a.score()},fastShot:function(){let t=$("td");for(let s of t)s.addEventListener("click",(function(){let t=s.getAttribute("id");$("#input_location").val(t),$("#input_shoot").click()}))},startListener:function(){$("#input_shoot").on("click",(function(t){if(t.preventDefault(),$("#warship_console").attr("class").includes("_hidden"))return;let s=$("#input_location"),a=s.val();switch(console.log(a),s.val(""),r.checkEnter(a)){case!1:n(s);break;case!0:switch(o(s),r.shoots++,h.shotsMade(),r.makeShot(a)){case!0:h.score(),e(a),r.hits++;for(let t of r.ships)1==t.hits.length&&0==t.hitted?(t.hitted=!0,r.hitted++,h.hittedShips()):4==t.hits.length&&0==t.sunken&&(t.hitted=!1,r.hitted--,h.hittedShips());switch(r.checkSunk()){case!0:switch(r.shipsSunken+=1,r.currentScore+=10,h.score(),h.sunkenShips(),r.shipsSunken==r.shipsTotal){case!0:c.endGame()}}break;case!1:i(a),r.misses++,h.misses(),r.currentScore>=10?r.currentScore-=10:r.currentScore<10&&(r.currentScore=0),h.score()}}}))}};c.startListener(),c.fastShot()}));